/*!
 * Start Bootstrap - SB Admin 2 v4.0.7 (https://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

var baseMapLayer=new ol.layer.Tile({source:new ol.source.OSM}),view=new ol.View({center:ol.proj.fromLonLat([-123.182615,49.260227]),zoom:13}),map=new ol.Map({target:"mapdiv",layers:[baseMapLayer],view:view});function createMarker(e,t,o,n,a,s,r,i){var l,c=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([t,o]))});return makeCircle(t,o).displayInfo=function(){zoom(ol.proj.fromLonLat([t+.0075,o])),intersectionInfo(e,n,a,s,r,i)},"bus"==i?l="vendor/fontawesome-free/svgs/solid/bus.svg":"ped"==i?l="vendor/fontawesome-free/svgs/solid/walking.svg":"bike"==i&&(l="vendor/fontawesome-free/svgs/solid/biking.svg"),c.setStyle(new ol.style.Style({image:new ol.style.Icon({color:"#0079B1",crossOrigin:"anonymous",scale:.15,opacity:1,src:l})})),c}function initMarkers(){var e=[];for(var t in intersections){var o=intersections[t],n=createMarker(o.id,o.lon,o.lat,o.name,o.avgbuswait,o.cars,o.peds,o.policy);e.push(n)}var a=new ol.source.Vector({features:e}),s=new ol.layer.Vector({source:a});map.addLayer(s)}function zoom(e){view.animate({center:e,zoom:15})}function makeCircle(e,t){var o=new ol.source.Vector,n=new ol.layer.Vector({source:o}),a=new ol.style.Style({image:new ol.style.Circle({radius:20,fill:new ol.style.Fill({color:"#ffffff"}),stroke:new ol.style.Stroke({color:"#0079B1",width:3})})}),s=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([e,t]))});return s.setStyle(a),o.addFeature(s),map.addLayer(n),s}function intersectionInfo(e,t,o,n,a,s){$("#graph-sidebar .sidebar-target").html(info),$("#graph-sidebar").removeClass("collapsed")}map.on("click",function(e){map.forEachFeatureAtPixel(e.pixel,function(e,t){e.displayInfo()})}),initMarkers(),$(document).on("click",".simulate-policy",function(){$(".stats table").fadeOut(500),setTimeout(function(){$(".stats .spinner-border").fadeIn(500),setTimeout(function(){var e=$(".stats table"),t=($(".stats table tbody"),$(".stats table tr")),o=document.createElement("th");o.innerHTML="Simulated",o.setAttribute("class","simulated");var n=document.createElement("td");n.innerHTML="10s",n.setAttribute("class","text-success simulated");var a=document.createElement("td");a.innerHTML="360",a.setAttribute("class","text-success simulated");var s=document.createElement("td");s.innerHTML="180",s.setAttribute("class","text-success simulated"),t[0].append(o),t[1].append(n),t[2].append(a),t[3].append(s);var r=document.createElement("button");r.innerHTML="Clear Simulations",r.setAttribute("class","btn btn-light simulated clear-simulated"),e.append(r),$(".stats .spinner-border").fadeOut(500),setTimeout(function(){$(".stats table").fadeIn(500)},500)},2e3)},500)}),$(document).on("click",".clear-simulated",function(){$(".simulated").remove()}),$(document).on("click",".close-sidebar",function(){$("#graph-sidebar").addClass("collapsed")}),$(document).on("change","#policy-select",function(e){var t=$("#policy-select option:selected").val(),o=this.parentElement.parentElement.dataset.intersection_id;intersections[o].policy=t,initMarkers()});